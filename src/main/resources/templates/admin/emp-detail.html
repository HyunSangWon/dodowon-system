<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
	  xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	  data-layout-decorate="~{layout/default}">

<div class="container-fluid" layout:fragment="content">
	<script type="text/javascript">
		$(function() {
			//부서 정보
			var dept_name = $("#dept_name").val();
			var jsonData = {
				"dept_name" : dept_name
			}
			$.ajax({
				type: 'POST',
				contentType: "application/json",
				url:'/admin/find/dept',
				data: JSON.stringify(jsonData),
				dataType: 'json',
				async: false,
				cache : false,
				success: function(data){
					for(var index=0 in data){
						$('#m_approver').append("<option  value='"+data[index].no+"' >"+data[index].name+"</option>");
						$('#f_approver').append("<option  value='"+data[index].no+"' >"+data[index].name+"</option>");
					}
				},
				error:function(xhr,status,error){
					console.log('error:'+error);
				}
			});//end ajax


			//결재자 정보
			var allApproval = $("#allApproval").val();

			if(allApproval == 'null'){//중간,최종 결재자가 없을경우
				$("#m_approver").val(allApproval).attr("selected", true);
				$("#f_approver").val(allApproval).attr("selected", true);
			}else{
				var m_approverNo = $("#approvalNo0").val();
				var f_approverNo = $("#approvalNo1").val();

				if(m_approverNo == undefined && $("#approverName0").val() == undefined){
					$("#m_approver").val('null').attr("selected", true);
				}else{
					$("#m_approver").val(m_approverNo).attr("selected", true);
				}
				if(f_approverNo == undefined && $("#approverName1").val() == undefined){
					$("#f_approver").val('null').attr("selected", true);
				}else{
					$("#f_approver").val(f_approverNo).attr("selected", true);
				}
			}

		});//end init

		function approvalUpdate(){
			if(confirm('결재정보를 수정 하시겠습니까?')){

				var m_approval = $("#m_approval").val();
				var f_approval = $("#f_approval").val();
				var empNo = $("#empNo").val();
				var jsonData = {
					"m_approval" : m_approval,
					"f_approval" : f_approval,
					"no" : empNo
				}

				$.ajax({
					type: 'POST',
					contentType: "application/json",
					url:'/admin/detail-view/update',
					data: JSON.stringify(jsonData),
					dataType: 'text',
					cache : false,
					success: function(data){
						alert(data);
						location.reload();
					},
					error:function(xhr,status,error){
						console.log(error);
					}
				});
			}
		}

	</script>
	<!-- Breadcrumbs-->
	<ol class="breadcrumb">
		<li class="breadcrumb-item"><a href="#">사원 관리</a></li>
		<li class="breadcrumb-item active">사원 정보</li>
	</ol>
	<div class="card mb-3">
		<div class="card-header">
			<i class="fas fa-user"></i> 사원 정보 양식
		</div>
		<div class="card-body">
			<div class="table-responsive">
					<!--결재 라인-->
					<input th:if="${allApproval} eq 'null'" type="hidden" id="allApproval" th:value="${allApproval}">
					<th:block th:if="${size} ne '0'" th:each="approval,index : ${list}">
						<input type="hidden" th:id="|approvalNo${index.index}|" th:value="${approval.no}">
						<input type="hidden" th:id="|approvalName${index.index}|" th:value="${approval.name}">
					</th:block>
					<!--사원 번호-->
					<input type="hidden" name="no" id="empNo" th:value="${empVO.no}">
					<!--아이디 -->
					<div class="form-group">
						<label class="control-label col-sm-2" for="id">아이디 :</label>
						<div class="col-md-4">
							<input readonly type="text" class="form-control" id="id"
								   name="id" th:value="${empVO.id}">
						</div>
					</div>
					<!--이름 -->
					<div class="form-group">
						<label class="control-label col-sm-2" for="name">이름
							:</label>
						<div class="col-md-4">
							<input readonly type="text" class="form-control"
								   id="name" name="name" th:value="${empVO.name}">
						</div>
					</div>
					<!--이메일 -->
					<div class="form-group">
						<label class="control-label col-sm-2" for="email">이메일 :</label>
						<div class="col-md-4">
							<input readonly  type="text" class="form-control" id="email"
								   name="email" th:value="${empVO.email}">
						</div>
					</div>
					<!--연락처 -->
					<div class="form-group">
						<label class="control-label col-sm-2" for="phone">연락처 :</label>
						<div class="col-md-4">
							<input readonly type="text" class="form-control" id="phone"
								   name="phone" th:value="${empVO.phone}">
						</div>
					</div>
					<!--readonly-->
					<!--소속회사 -->
					<div class="form-group">
						<label for="company" class="col-sm-2 col-form-label">소속  :</label>
						<div class="col-md-4">
							<input type="text" readonly class="form-control" id="company" name="company" th:value="${empVO.company}">
						</div>
					</div>
					<!-- 소속부서 -->
					<div class="form-group">
						<label for="dept_name" class="col-sm-2 col-form-label">소속부서  :</label>
						<div class="col-md-4">
							<input type="text" readonly class="form-control" id="dept_name" name="dept_name" th:value="${empVO.dept_name}">
						</div>
					</div>
					<!--직급-->
					<div class="form-group">
						<label for="emp_rank" class="col-sm-2 col-form-label">직급  :</label>
						<div class="col-md-4">
							<input type="text" readonly class="form-control" id="emp_rank" name="emp_rank" th:value="${empVO.emp_rank}">
						</div>
					</div>
					<!-- 휴가일-->
					<div class="form-group">
						<label for="holiday" class="col-sm-2 col-form-label">휴가일  :</label>
						<div class="col-md-4">
							<input type="text" readonly class="form-control" id="holiday" name="holiday" th:value="${empVO.holiday}">
						</div>
					</div>
				<!--중간 결재자-->
				<div class="form-group">
					<label for="m_approver">중간 결재자 :</label>
					<div class="col-md-4">
						<select class="browser-default custom-select" id="m_approver" name="m_approver">
							<option value="non">결재자를 선택하세요.</option>
							<option value="null">해당 없음</option>
						</select>
					</div>
				</div>
				<!--최종 결재자-->
				<div class="form-group">
					<label for="f_approver">최종 결재자 :</label>
					<div class="col-md-4">
						<select class="browser-default custom-select" id="f_approver" name="f_approver">
							<option value="non">결재자를 선택하세요.</option>
							<option value="null">해당 없음</option>
						</select>
					</div>
				</div>
					<!--Submit -->
					<div class="form-group">
						<div class="col-sm-offset-2 col-sm-10">
							<!-- <button class="btn btn-danger" type="button" onclick="removeEmpInfo()"
							style="margin: 10px 0 0 120px;  width: 180px;" >사원 탈퇴</button> -->
							<button class="btn btn-warning" type="button" onclick="approvalUpdate()"
									style="margin: 10px 0 0 120px;  width: 180px;" >결재라인 수정</button>
						</div>
					</div>
			</div>
		</div>
	<div class="card-footer small text-muted" th:text="|Updated at ${now}|">Updated at 11:59 PM</div>
	</div>
</div>

</html>