<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.dodo.system.mapper.DocsMapper">

    <insert id="setHoliday" parameterType="com.dodo.system.vo.HolidayVO">
        INSERT INTO docs_holiday
        (
           emp_no,holiday_type,holiday_start,holiday_end,replacement,holiday_reason
        )
        VALUES
        (
           #{emp_no},#{holiday_type},#{holiday_start},#{holiday_end},#{replacement},#{holiday_reason}
        )
    </insert>

    <select id="findByHolidayNo" resultType="com.dodo.system.vo.HolidayVO">
        SELECT
               no,holiday_type,holiday_start,holiday_end,replacement,holiday_reason
        FROM
             docs_holiday
        WHERE
              NO = #{no};
    </select>

    <select id="totalCntHoliday" resultType="Integer">
        SELECT COUNT(no)
        FROM docs_holiday
        WHERE emp_no = #{emp_no}
        AND holiday_status = #{holiday_status}
    </select>

    <select id="holidayList" resultType="com.dodo.system.vo.HolidayVO">
        SELECT
            dh.no,e.name,dh.holiday_type,dh.holiday_start,dh.holiday_end,dh.holiday_status,
               DATE_FORMAT(holiday_reg_date,'%Y-%m-%d %H:%i') holiday_reg_date
        FROM docs_holiday dh,emp e
        WHERE dh.emp_no = e.no
          AND dh.emp_no = #{emp_no}
          AND dh.holiday_status = #{holiday_status}
        ORDER BY dh.no DESC
        LIMIT #{limitcount},#{contentnum}
    </select>

    <delete id="removeHoliday">
        DELETE
        FROM docs_holiday
        WHERE no = #{no};
    </delete>

    <update id="updateHoliday" parameterType="com.dodo.system.vo.HolidayVO">
        UPDATE
            docs_holiday
        SET
            holiday_type = #{holiday_type},
            holiday_start = #{holiday_start},
            holiday_end = #{holiday_end},
            replacement = #{replacement},
            <if test="holiday_reason != '' ">
                holiday_reason = #{holiday_reason}
            </if>
        WHERE
            no = #{no}
    </update>
    
    <insert id="setTrip" parameterType="com.dodo.system.vo.TripVO">
    	 INSERT INTO docs_trip
        (
           emp_no,docs_no,location,reason,bt_start,bt_end,food_money,room_charge,tran_cost,tran_local_cost,etc,team_cnt
        )
        VALUES
        (
           #{emp_no},#{docs_no},#{location},#{reason},#{bt_start},#{bt_end},#{food_money},#{room_charge},#{tran_cost},#{tran_local_cost},#{etc},#{team_cnt}
        )
    </insert>
    
    <insert id="setTripProposer" parameterType="com.dodo.system.vo.TripProposerVO">
  	 	INSERT INTO docs_trip_proposer
        (
           trip_no,dept_name,emp_rank,name,private_num,replacement,account
        )
        VALUES
        (
           #{trip_no},#{dept_name},#{emp_rank},#{name},#{private_num},#{replacement},#{account}
        )
    </insert>
    
    
    <select id="getTripNo" resultType="Integer" parameterType="com.dodo.system.vo.TripVO">
    	SELECT no
		FROM docs_trip
		WHERE 	
			emp_no = #{emp_no}
		AND
			docs_no = #{docs_no}
			
		AND 	
			location = #{location}
		AND 
			bt_start = #{bt_start}
		AND 
			bt_end = #{bt_end}
    </select>

    <insert id="setEtc" parameterType="com.dodo.system.vo.TripEtcVO">
  	 	INSERT INTO docs_trip_etc
        (
           trip_no,g_num,help,b_num
        )
        VALUES
        (
           #{trip_no},#{g_num},#{help},#{b_num}
        )
    </insert>
    
    <!--MY 결재함 - 출장 문서 페이징 쿼리 -->
    <select id="totalCntTrip" resultType="Integer">
    	SELECT COUNT(no)
        FROM docs_trip
        WHERE emp_no = #{emp_no}
        AND trip_status = #{trip_status}
    </select>

    <select id="tripList" resultType="com.dodo.system.vo.TripVO">
        SELECT
               location,bt_start,bt_end,trip_status,
               DATE_FORMAT(trip_reg_date,'%Y-%m-%d %H:%i') trip_reg_date,
               team_cnt
        FROM
             docs_trip
        WHERE
              emp_no = #{emp_no}
        AND
              trip_status = #{trip_status}
        ORDER BY no DESC
        LIMIT #{limitcount},#{contentnum}
    </select>



</mapper>