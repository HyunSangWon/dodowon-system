<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.dodo.system.mapper.EmpMapper">

    <select id="findByEmpId" resultType="com.dodo.system.vo.EmpVO">
        SELECT
        	no,
        	id,
        	password,
        	name,
        	email,
        	phone,
        	company,
        	dept_name,
        	emp_rank,
        	holiday,
        	sign_img_name,
            m_approver,
            f_approver
        FROM emp
       	WHERE id = #{id}
    </select>

    <insert id="setEmp" parameterType="com.dodo.system.vo.EmpVO">
        INSERT INTO emp
        (
            no,
            id,
            password,
            name,
            email,
            phone,
            company,
            dept_name,
            emp_rank,
            holiday,
            m_approver,
            f_approver
        )
        VALUES
        (
            #{no},
            #{id},
            #{password},
            #{name},
            #{email},
            #{phone},
            #{company},
            #{dept_name},
            #{emp_rank},
            #{holiday},
            #{m_approver},
            #{f_approver}
        )
    </insert>
    
    <select id="totalCntEmp" resultType="Integer">
        SELECT 
        	COUNT(no)
        FROM emp
    </select>

    <select id="EmpList" resultType="com.dodo.system.vo.EmpVO">
        SELECT
            no,
            id,
            company,
            dept_name,
            emp_rank,
            name,
            holiday
        FROM emp
        ORDER BY 
        	no DESC
        LIMIT #{limitcount},#{contentnum}
    </select>
    
    <update id="updateMyInfo" parameterType="com.dodo.system.vo.EmpVO">
        UPDATE emp
        SET
	        id = #{id},
	        name = #{name},
	        email = #{email},
	        phone = #{phone}
        WHERE no = #{no}
    </update>
    
     <update id="updateMyPassword" parameterType="com.dodo.system.vo.EmpVO">
        UPDATE emp
        SET
	        password = #{password}
        WHERE no = #{no}
    </update>
    
     <update id="updateMyImage" >
        UPDATE emp
        SET
	        sign_img_name = #{sign_img_name}
        WHERE no = #{no}
    </update>
    
    <select id="getImgName" resultType="com.dodo.system.vo.EmpVO">
    	SELECT
    		sign_img_name
    	FROM emp
    	WHERE no = #{no}
    </select>

	<update id="updateHoliday">
		UPDATE emp 
		SET 
			holiday = #{holiday}
		WHERE no = #{no}
	</update>
	
	<select id="getHoliday" resultType="com.dodo.system.vo.EmpVO">
		SELECT 
		 	no,
		 	name,
		 	holiday
		FROM emp 
		WHERE no = #{empNo}
	</select>

    <select id="empFindAll" resultType="com.dodo.system.vo.EmpVO" >
        SELECT
            e.no,
            e.name,
            e.company,
            e.dept_name,
            e.emp_rank,
            r.role_name,
            e.holiday
        FROM emp e,role r,emp_role er
        WHERE e.no = er.emp_id
          AND er.role_id = r.no
    </select>

	<select id="deptFindAll" resultType="com.dodo.system.vo.EmpVO">
		SELECT 
			no,
			name,
			emp_rank
		FROM emp
		WHERE dept_name = #{dept_name}
	</select>

    <select id="getApprovalName" resultType="com.dodo.system.vo.EmpVO">
        SELECT
            name,
            no
        FROM emp
        WHERE no = #{m_approval}
        UNION ALL
        SELECT
            name,
            no
        FROM emp
        WHERE no = #{f_approval}
    </select>


    <update id="updateApprovalLine" parameterType="com.dodo.system.vo.EmpVO">
        UPDATE
            emp
        SET
            m_approver = #{m_approver},
            f_approver = #{f_approver}
        WHERE no = #{no}
    </update>

</mapper>